<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Redis restudy 6 conf 持久化"><meta name="keywords" content="Redis"><meta name="author" content="YN"><meta name="copyright" content="YN"><title>Redis restudy 6 conf 持久化 | uwupu Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '6.2.0'
} </script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="uwupu Blog" type="application/atom+xml">
<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"></noscript></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis-conf"><span class="toc-number">1.</span> <span class="toc-text">Redis.conf</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BD%8D"><span class="toc-number">1.1.</span> <span class="toc-text">单位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#include"><span class="toc-number">1.2.</span> <span class="toc-text">include</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">1.3.</span> <span class="toc-text">网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#General"><span class="toc-number">1.4.</span> <span class="toc-text">General</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SNAPSHOTTING-%E5%BF%AB%E7%85%A7"><span class="toc-number">1.5.</span> <span class="toc-text">SNAPSHOTTING 快照</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#REPLICATION%E5%A4%8D%E5%88%B6"><span class="toc-number">1.6.</span> <span class="toc-text">REPLICATION复制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SECURITY%E5%AE%89%E5%85%A8"><span class="toc-number">1.7.</span> <span class="toc-text">SECURITY安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CLIENTS%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">1.8.</span> <span class="toc-text">CLIENTS客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#APPEND-ONLY-MODE-%E6%A8%A1%E5%BC%8F-aof"><span class="toc-number">1.9.</span> <span class="toc-text">APPEND ONLY MODE 模式 aof</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Redis%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">Redis持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RDB%EF%BC%88Redis-Database%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">RDB（Redis Database）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.1.1.</span> <span class="toc-text">触发条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rdb%E6%96%87%E4%BB%B6%E6%81%A2%E5%A4%8D"><span class="toc-number">2.1.2.</span> <span class="toc-text">rdb文件恢复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOF%EF%BC%88Append-Only-File%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">AOF（Append Only File）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.3.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E9%87%8D%E5%86%99"><span class="toc-number">2.3.2.</span> <span class="toc-text">AOF重写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.3.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOF%E6%96%87%E4%BB%B6%E4%BF%AE%E5%A4%8D"><span class="toc-number">2.3.4.</span> <span class="toc-text">AOF文件修复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9-1"><span class="toc-number">2.3.5.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">2.3.6.</span> <span class="toc-text">缺点</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">YN</div><div class="author-info__description text-center">一个包含有学习日记的博客</div><div class="follow-button"><a target="_blank" rel="noopener" href="https://uwupu.tk/">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">104</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">30</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://uwupu.tk/">uwupuBlog</a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">uwupu Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">诶嘿</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">Redis restudy 6 conf 持久化</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-02-13</time><span class="post-meta__separator">|</span><span class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">1.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 6 分钟</span></span></div><div class="article-container" id="post-content"><h1 id="Redis-conf"><a href="#Redis-conf" class="headerlink" title="Redis.conf"></a>Redis.conf</h1><h2 id="单位"><a href="#单位" class="headerlink" title="单位"></a>单位</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1k =&gt; 1000 bytes</span></span><br><span class="line"><span class="comment"># 1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="comment"># 1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="comment"># 1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="comment"># 1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="comment"># 1gb =&gt; 1024*1024*1024 bytes</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span></span><br></pre></td></tr></tbody></table></figure>

<p>在单位上，大小写不敏感。</p>
<h2 id="include"><a href="#include" class="headerlink" title="include"></a>include</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># include /path/to/local.conf</span></span><br><span class="line"><span class="comment"># include /path/to/other.conf</span></span><br></pre></td></tr></tbody></table></figure>

<p>可以包含别的配置文件。</p>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 127.0.0.1 ::1  <span class="comment">#绑定的IP地址</span></span><br><span class="line">protected-mode <span class="built_in">yes</span> <span class="comment"># 保护模式开关</span></span><br><span class="line">port 6379 <span class="comment"># 端口</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="General"><a href="#General" class="headerlink" title="General"></a>General</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">daemonize <span class="built_in">yes</span> <span class="comment">#以守护进程方式运行</span></span><br><span class="line">pidfile /var/run/redis/redis-server.pid  <span class="comment">#若以后台方式运行，就需要指定一个pid文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># debug (a lot of information, useful for development/testing)</span></span><br><span class="line"><span class="comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="comment"># notice (moderately verbose, what you want in production probably) 生产环境适用</span></span><br><span class="line"><span class="comment"># warning (only very important / critical messages are logged)</span></span><br><span class="line">loglevel notice  <span class="comment">#日志级别</span></span><br><span class="line"></span><br><span class="line">logfile /var/log/redis/redis-server.log  <span class="comment">#日志的文件位置</span></span><br><span class="line">databases 16 <span class="comment"># 默认数据库数量</span></span><br><span class="line">always-show-logo <span class="built_in">yes</span>  <span class="comment">#是否总是展示logo</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="SNAPSHOTTING-快照"><a href="#SNAPSHOTTING-快照" class="headerlink" title="SNAPSHOTTING 快照"></a>SNAPSHOTTING 快照</h2><p>持久化，在规定的时间内，执行了多少次操作，则会进行一次持久化。</p>
<p>Redis是内存数据库，没有持久化，数据断电即失。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">save 900 1     <span class="comment">#每隔900秒尝试进行保存，若修改次数&gt;=1则进行一次快照保存</span></span><br><span class="line">save 300 10    <span class="comment">#每隔300秒尝试进行保存，若修改次数&gt;=10则进行一次快照保存</span></span><br><span class="line">save 60 10000  <span class="comment">#每隔60秒尝试进行保存，若修改次数&gt;=10000则进行一次快照保存</span></span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">stop-writes-on-bgsave-error <span class="built_in">yes</span>  <span class="comment">#持久化出错，是否继续工作</span></span><br><span class="line">rdbcompression <span class="built_in">yes</span> <span class="comment"># 是否开启rdb文件压缩，需要消耗CPU资源</span></span><br><span class="line">rdbchecksum <span class="built_in">yes</span> <span class="comment">#保存rdb文件时，进行rdb文件校验</span></span><br><span class="line">dbfilename dump.rdb <span class="comment">#rdb文件保存目录</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="REPLICATION复制"><a href="#REPLICATION复制" class="headerlink" title="REPLICATION复制"></a>REPLICATION复制</h2><p>…</p>
<h2 id="SECURITY安全"><a href="#SECURITY安全" class="headerlink" title="SECURITY安全"></a>SECURITY安全</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass 123456 <span class="comment"># 设置密码，默认没有密码</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="CLIENTS客户端"><a href="#CLIENTS客户端" class="headerlink" title="CLIENTS客户端"></a>CLIENTS客户端</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">maxclients 1000 <span class="comment">#设置redis最大客户端数量</span></span><br><span class="line">maxmemory &lt;bytes&gt; <span class="comment">#设置最大内存容量</span></span><br><span class="line">maxmemory-policy noeviction <span class="comment">#内存满了，处理策略</span></span><br><span class="line">	<span class="comment">#noeviction: 不删除策略, 达到最大内存限制时, 如果需要更多内存, 直接返回错误信息。（默认值）</span></span><br><span class="line">	<span class="comment">#allkeys-lru: 所有key通用; 优先删除最近最少使用(less recently used ,LRU) 的 key。</span></span><br><span class="line">	<span class="comment">#volatile-lru: 只限于设置了 expire 的部分; 优先删除最近最少使用(less recently used ,LRU) 的 key。	#allkeys-random: 所有key通用; 随机删除一部分 key。</span></span><br><span class="line">	<span class="comment">#volatile-random: 只限于设置了 expire 的部分; 随机删除一部分 key。</span></span><br><span class="line">	<span class="comment">#volatile-ttl: 只限于设置了 expire 的部分; 优先删除剩余时间(time to live,TTL) 短的key。</span></span><br><span class="line">    </span><br></pre></td></tr></tbody></table></figure>

<h2 id="APPEND-ONLY-MODE-模式-aof"><a href="#APPEND-ONLY-MODE-模式-aof" class="headerlink" title="APPEND ONLY MODE 模式 aof"></a>APPEND ONLY MODE 模式 aof</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appendonly no  <span class="comment">#默认不开启aof模式，</span></span><br><span class="line">	<span class="comment">#默认使用的是rdb方式持久化，大部分情况下rdb够用。</span></span><br><span class="line">appendfilename <span class="string">"appendonly.aof"</span>  <span class="comment">#持久化文件名</span></span><br><span class="line">appendfsync everysec <span class="comment"># 每秒执行一次同步，可能会丢失这一秒的数据</span></span><br><span class="line">	<span class="comment">#always  #每次修改值都会写入</span></span><br><span class="line">	<span class="comment">#no      #不执行，这个时候操作系统自己同步数据，速度最快。</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h1><p>参考文献：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xing1/p/16380120.html">https://www.cnblogs.com/xing1/p/16380120.html</a></p>
<p>Redis是内存数据库，若不将内存中数据库状态保存到磁盘，一旦服务器进程退出，服务器中数据库状态就会消失，所以Redis提供了持久化功能。</p>
<h2 id="RDB（Redis-Database）"><a href="#RDB（Redis-Database）" class="headerlink" title="RDB（Redis Database）"></a>RDB（Redis Database）</h2><p>指定时间间隔内将内存中数据快照写入磁盘。</p>
<p>Redis单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程结束了，再用这个临时文件替换上次持久化好的文件。</p>
<p>主进程不进行任何IO操作，确保了极高的性能。</p>
<p>如果要大规模进行数据恢复，且对于数据恢复的完整性不是非常敏感，那RDB的方式要比AOF方式更加高效。RDB缺点是最后一次持久化后数据可能丢失。</p>
<p>默认情况下使用RDB。</p>
<p>默认保存文件为：dump.rdb</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbfilename: dump.rdb</span><br></pre></td></tr></tbody></table></figure>

<h3 id="触发条件"><a href="#触发条件" class="headerlink" title="触发条件"></a>触发条件</h3><ol>
<li>save规则满足</li>
<li>执行flushall</li>
<li>关闭redis服务器</li>
</ol>
<h3 id="rdb文件恢复"><a href="#rdb文件恢复" class="headerlink" title="rdb文件恢复"></a>rdb文件恢复</h3><p>将rdb文件放到Redis启动目录就可，redis启动会检查rdb文件然后恢复。</p>
<ul>
<li>/user/local/bin</li>
</ul>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ol>
<li><p>适合大规模数据恢复</p>
</li>
<li><p>对数据完成性要求不高</p>
</li>
</ol>
<p>缺点：</p>
<ol>
<li>需要一定的时间间隔进程操作。若redis意外宕机了，最后一次修改数据就没有了</li>
<li>fork进程的时候，会占用一定的内存空间。</li>
</ol>
<p>有时候在生产环境我们会对这个文件进行备份。</p>
<h2 id="AOF（Append-Only-File）"><a href="#AOF（Append-Only-File）" class="headerlink" title="AOF（Append Only File）"></a>AOF（Append Only File）</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>将所有命令都记录下来，恢复的时候就把这个文件再全部执行一遍；</p>
<p>以日志的形式记录每个写操作，将Redis执行过的所有指令记录下来（不记录读操作），只可追加文件不可改写文件，Redis启动之初会读取该文件重新构建数据，Redis重启的话就根据日志文件的内容将所有指令执行一次以完成数据恢复操作。</p>
<h3 id="AOF重写"><a href="#AOF重写" class="headerlink" title="AOF重写"></a>AOF重写</h3><p>AOF追加文件会越来越大，这样不合理；</p>
<p>为了解决这个问题，当文件大到一定程度，会触发<strong>AOF重写</strong>；</p>
<p>AOF重写会将内存中的数据库用命令的方式重写一个aof文件，来为AOF文件<strong>减肥</strong>。</p>
<ul>
<li>当AOF文件体积变得过大时，会fork出一条新进程来将文件重写（先写临时文件，然后rename），遍历新进程的内存数据，每条记录有一条set语句。重写aof文件操作，没有读取旧的aof文件，而是将<strong>整个内存中的数据库内容用命令的方式重写一个新的aof文件</strong>（与快照类似）。</li>
<li>在子进程重写期间，服务端正常对外服务，服务端会将在重写期间收到的数据缓存到aof_rewrite_buf中，也就是单独开辟一块缓存来存储重写期间收到的命令，在子进程重写完成后，再把缓存的数据追加到新的aof文件中。</li>
<li>重写期间写出的aof文件是一个临时文件，不是旧文件，在重写结束后会删除旧的aof文件，然后临时文件会rename，成为当前使用的aof文件。</li>
</ul>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>AOF默认文件：appendonly.aof</p>
<p><strong>AOF默认不开启</strong>，需要手动开启</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appendonly no <span class="comment">#no表示关闭 yes表示开启</span></span><br><span class="line">appendfilename <span class="string">"appendonly.aof"</span></span><br><span class="line">no-appendfsync-on-rewrite no <span class="comment">#在执行AOF重写期间是否进行AOF文件同步</span></span><br><span class="line">auto-aof-rewrite-percentage 100 <span class="comment">#目前AOF文件超过上次重写文件的百分之多少时候再次重写，这里指上次重写文件的1倍</span></span><br><span class="line">auto-aof-rewrite-min-size 64mb  <span class="comment">#设置允许重写的最小文件大小，防止文件本身就小还要重写。</span></span><br><span class="line"></span><br><span class="line">aof-use-rdb-preamble no <span class="comment">#Redis4.0新增的RDB-AOF混合持久化方式，其中RDB负责记录已有数据，AOF负责记录最近发生变化的数据。这样就同时兼有AOF和RDB的优点：既能够快速生成重写文件，也能在出现问题时，快速地载入数据。</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="AOF文件修复"><a href="#AOF文件修复" class="headerlink" title="AOF文件修复"></a>AOF文件修复</h3><p>当aof文件有错误，Redis则无法启动，就需要修复这个aof文件；</p>
<p>redis提供了一个工具<code>redis-check-aof</code></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-check-aof --fix appendonly.aof</span><br></pre></td></tr></tbody></table></figure>

<p><code>redis-check-aof</code>修复会删除错误的指令，将错误的数据删除。</p>
<h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><ol>
<li>每次修改都同步，文件完整性更高</li>
</ol>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ol>
<li>数据文件大，</li>
<li>修复速度慢</li>
<li>AOF运行效率比rdb低</li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">YN</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://zswh33.github.io/2023/02/13/Redis-restudy-6/">http://zswh33.github.io/2023/02/13/Redis-restudy-6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://zswh33.github.io">uwupu Blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2023/02/13/Redis-restudy-7/"><i class="fa fa-chevron-left">  </i><span>Redis restudy 7 发布订阅 主从复制 哨兵模式</span></a></div><div class="next-post pull-right"><a href="/2023/02/13/Redis-restudy-5/"><span>Redis restudy 5 事务 监视Jedis SpringBootRedis</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">©2019 - 2023 By YN</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">哇！感谢你来到这个Blog，虽然没有什么内容...嗯..</div><div class="busuanzi"><script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/bundle.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>